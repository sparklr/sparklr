<script>
	if (data.error) {
		</script>
		<div class='contentwrapper'>
			An unknown error occurred.
		</div>
		</script>
	} else {

	DISPLAYNAMES[data.user] = data.name;
	USERHANDLES[data.user] = data.handle;
	AVATAR_IDS[data.user] = data.avatarid;

	var pageType = fragments[3];

</script>
<% if (pageType == "step2") %>
	<input type='button' value='Next' onClick='editProfile();location.href="/#/invite/step3";' style='margin:7px 4px;float:right'>
	<h2 style='color:#fff'>Customize your profile</h2>
	<div class='bubbleout'><div class='bubble leftb' style='margin-top: -60px;'>Here you can change your display name, description, icon, and background.</div></div>
	<div class='bubbleout'><div class='bubble leftb' style='margin-top: 200px;'>When you change your background image, you change the background of the main site as well! This gives you some customization when it comes to how you want your dashboard to look.</div></div>

<% endif %>
<% if (data.user == curUser) %>
<div id='profileheader' class='profileheader' onDrop='dropImage(event, headerUploadCallback);' onDragEnter='dropPrevent(event);' onDragOver='dropPrevent(event);'>
	<% else %>
	<div class='profileheader' id='profileheader'>
		<% endelse %>
		<img class='avatar' id='useravatar' src='{ getAvatar(data.user) }' onDrop='dropImage(event, avatarUploadCallback);' onDragEnter='dropPrevent(event);' onDragOver='dropPrevent(event);'><br>
		<p id='userDisplayName'>{ getDisplayName(data.user) }</p>
		<p>@{getUserHandle(data.user)}</p>
		<p id='userBio'>{processMedia(data.bio.replace(/\n/g,'<br>'),true)}</p>
			<% if (HIDDEN_USERS.indexOf(data.user.toString()) != -1) %>
			<p class='headersubtitle'><b>You have hidden this user. <a href='/#/settings/blacklist' style='text-decoration:underline'>Change Settings</a></b></p>
			<% endif %>
		<div id='sidebar_links'>
			<% if (data.user != curUser) %>
				<% if (data.following) %>	
					<a href='javascript:unfollow("{data.user}");'>Unfollow</a>
				<% else %>
					<a href='javascript:follow("{data.user}");'>Follow</a>
				<% endelse %>
				<a href='javascript:chatWith("{data.user}");'>Message</a>
			<% endif %>
			<a href='/#/user/{data.user}/mentions'>Mentions</a>
			<a href='/#/user/{data.user}/photos'>Photos</a>
			<% if (data.user == curUser) %> 
				<a id='editBtn' href='javascript:editProfile()'>Edit</a>
				<a href='#/settings'>Settings</a>
				<a href='javascript:signOff();'>Sign off</a>
			<% endif %>
		</div>
	</div>
	<div id='editContainer' style='display:none' class='timelineitem'>
		<b>Avatar</b><br>
		<input type='file' onchange='loadImage(this.files[0], avatarUploadCallback)'><br>
		<b>Header</b><br>
		<input type='file' onchange='loadImage(this.files[0], headerUploadCallback)'><br>
	</div>
	<script>
		currentPageType = "STREAM";

		if (pageType == "photos")
			currentPageType = "PHOTO";
		if (pageType == "mentions")
			currentPageType = "MENTIONS";
		if (pageType == "step2") {
			setTimeout(function() {
				editProfile(); 
			}, 10);
		}

	</script>
	<div id='newposts' onclick='updatePages()'></div>
	<div id='timeline_container'></div>
	<script>
		setTimeout(function() {
				var arr = data.timeline;

				for(var i = arr.length-1; i >= 0; i--) {
					addTimelineEvent(arr[i]);
				}

				addTimelineArray(arr,subscribedStream);

				}, 10);
		}

		setTimeout(function() { 
			updateHeader(data.user,data.avatarid); 
		}, 0);

		subscribedStream = data.user;
		subscribeToStream(data.user.toString());
		_g("content").style.minHeight = 0;

	</script>
