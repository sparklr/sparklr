<script>
	if (data.error) {
		if (data.info.notFriends) {
			</script>
				<div class='contentwrapper'>
					<div style='height:65px;'>
						 <img src='{getAvatar(fragments[2])}' class='avatar'>
						 <b>{getDisplayName(fragments[2])}</b>
					</div>
					<b>You do not have permission to view this profile</b>.<br>
					In order to view this page, {getUserHandle(fragments[2])} must whitelist you.
					<br><br>
					<input type='button' value='Request Whitelist' id='btnWhitelist' onClick='requestWhitelist({fragments[2]});'>
				</div>
			<script>
		} else {
			</script>
			<div class='contentwrapper'>
				An unknown error occurred.
			</div>
			<script>
		}
	} else {

	DISPLAYNAMES[data.user] = data.name;
	USERHANDLES[data.user] = data.handle;
	AVATAR_IDS[data.user] = data.avatarid;

	var pageType = fragments[3];

</script>
<% if (pageType == "step2") %>
	<input type='button' value='Next' onClick='editProfile();location.href="/#/invite/step3";' style='margin:7px 4px;float:right'>
	<h2 style='color:#fff'>Customize your profile</h2>
	<div class='bubbleout'><div class='bubble leftb' style='margin-top: -60px;'>This is your profile, here you can change your display name, description, icon, and background.</div></div>
	<div class='bubbleout'><div class='bubble leftb' style='margin-top: 200px;'>When you change your background image, you change the background of the main site as well! This gives you some customization when it comes to how you want your dashboard to look.</div></div>

<% endif %>
<% if (data.user == curUser) %>
<div id='profileheader' class='profileheader' onDrop='dropImage(event, avatarUploadCallback);' onDragEnter='dropPrevent(event);' onDragOver='dropPrevent(event);'>
	<% else %>
	<div class='profileheader' id='profileheader'>
		<% endelse %>
		<p class='headertitle' id='userDisplayName'>{ getDisplayName(data.user) }</p>
		<p class='headersubtitle'>@{getUserHandle(data.user)}</p>
		<p class='headersubtitle' id='userBio'>{processMedia(data.bio.replace(/\n/g,'<br>'),true)}</p>
		<div id='userTip' style='display:none;position:absolute;bottom:45px;left:0px'><p class='headersubtitle'>Drag an image here, or <u>choose a file</u>
			<input type='file' style='opacity:0;position:absolute;left:50px' onchange='loadImage(this.files[0], avatarUploadCallback)'>
		</p></div>
			<% if (HIDDEN_USERS.indexOf(data.user.toString()) != -1) %>
			<p class='headersubtitle'><b>You have hidden this user. <a href='/#/settings/blacklist' style='text-decoration:underline'>Change Settings</a></b></p>
			<% endif %>
		<div class='actions'>
			<% if (data.user == curUser) %> 
			<input id='editBtn' type='button' value='Edit' onClick='editProfile();'>
			<div id='sidebar_links'>
				<div class='unimportant'>
					<a href='#/settings'>Settings</a>
					<a href='javascript:signOff();'>Sign off</a>
				</div>
			</div>
			<% else %>
				<% if (data.following) %>	
					<input type='button' value='Unfollow' onClick='unfollow("{data.user}");'>
				<% else %>
					<input type='button' value='Follow' onClick='follow("{data.user}");'>
				<% endelse %>
			<input type='button' value='Mention' onClick='mention("{data.handle}");'>
			<input type='button' value='Message' onClick='chatWith("{data.user}");'>
			<% endelse %>
		</div>
		<div class='controls'>
			<input type='button' value='Posts' onClick='location.href="#/user/{data.user}/";'>
			<input type='button' value='Mentions' onClick='location.href="#/user/{data.user}/mentions";'>
		</div>
	</div>
	<div id='backgroundTip' style='display:none;position:fixed;bottom:10px;left:0px'>
		<p class='headersubtitle'>Drag a background image here,<br> or <u>choose a file</u>
			<input type='file' style='opacity:0;position:absolute;left:0px' onchange='loadImage(this.files[0], backgroundUploadCallback)'><br>
			<a href='javascript:removeBackground();' id='removeBackground' style='<% if (!data.background) %>display: none;<% endif %>text-decoration:underline;color:#fff'>Remove background</a>
		</p>
	</div>
	<script>
		currentPageType = "STREAM";

		if (pageType == "photos")
			currentPageType = "PHOTO";
		if (pageType == "mentions")
			currentPageType = "MENTIONS";
		if (pageType == "step2") {
			setTimeout(function() {
				editProfile(); 
			}, 10);
		}

	</script>
	<div id='timeline_container'></div>
	<script>
		setTimeout(function() {
				var arr = data.timeline;

				for(var i = arr.length-1; i >= 0; i--) {
					addTimelineEvent(arr[i]);
				}

				addTimelineArray(arr,subscribedStream);

				}, 10);
		}

		setTimeout(function() { 
			updateHeader(data.user,data.avatarid); 
			if (data.background && !MOBILE)
				updateBackground(data.user,data.background);
		}, 0);

		subscribedStream = data.user;
		_g("content").style.minHeight = 0;

		document.body.ondrop = function(e) { 
			dropImage(e, backgroundUploadCallback); };
	</script>
